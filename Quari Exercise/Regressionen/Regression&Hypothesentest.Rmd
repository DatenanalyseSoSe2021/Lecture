---
title: "Regressionen"
author: "Yilun"
date: "5/18/2021"
output: 
   html_document:
    #variant: markdown_github
    toc: true
    number_sections: false
    self_contained: no
    toc_depth: 4
    toc_float: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(wooldridge)
library(ggplot2)
```

## Regression

### 1 Loading and inspectindg Data

```{r}
data(hprice1)
glimpse(hprice1)
```

### 2 A first regression 

```{r}
my.lm1 = lm(price~ sqrft, data = hprice1)
ggplot(hprice1,aes(sqrft, price))+
  geom_point()+
  stat_smooth(method = "lm",col = "red")
summary(my.lm1)
```


#### 2.1 Using prdict for predictions 

```{r}
my.price.hat = predict(my.lm1)
head(my.price.hat)

```

### 3 Random data Subsets

A simple way of obtaining a random sample is the following:

• First, reorder rows randomly

• Second, take (for example) the ﬁrst 80 percent of the rows

```{r}
my.random.index <- sample(nrow(hprice1), replace = FALSE)
head(my.random.index)
```

### 4 Tasks

1. Write a function my.RSS with two inputs: a string describing the formula and the dataset. The function carries out the regression and returns the RSS (residual sum of squares)

```{r}
my.RSS = function(my.str, my.data){
  sum(lm(my.str,data = my.data)$residuals^2)
}

#Testing
my.RSS(my.str = "price~sqrft", my.data = hprice1)
```

2. Write a function that has two input arguments: a data and a number for the split (e.g. 0.8 for 80 percent). The function returns randomly selected training and test datasets

```{r}
my.data.select = function(my.data, split){
  nrow.train = round(nrow(my.data)*split,0)
  nrow.test = nrow(my.data)-nrow.train
  return(
    list(
      traindata = my.data[sample(nrow(my.data),nrow.train, replace = FALSE),],
      testdata = sample_n(my.data,nrow.test)
    )
  )
}

# Testing 1
my.datasets = my.data.select(my.data = hprice1, split=0.8)
glimpse(my.datasets)
```

## Hypothesentest
